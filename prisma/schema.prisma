generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Cliente {
  id                String           @id @default(cuid())
  name              String
  email             String?          @unique
  phone             String?
  taxId             String?
  status            String           @default("ACTIVE")
  responsibleId     String?
  lastActivity      String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  address           String?
  contactPerson     String?
  metricoolBrandId  String?
  nombreComercial   String?
  campanasMailing   CampanaMailing[]
  campanasSEM       CampanaSEM[]
  usuariosAsignados ClienteUsuario[]
  contratos         Contrato[]
  credentials       Credential[]
  dominios          Dominio[]
  hostings          Hosting[]
  proyectos         Proyecto[]

  @@map("clientes")
}

model Credential {
  id                 String   @id @default(cuid())
  clienteId          String
  category           String
  platform           String
  url                String?
  username           String
  passwordEncrypted  String
  email              String?
  isEmailAccount     Boolean  @default(false)
  emailProvider      String?
  parentId           String?
  notes              String?
  isActive           Boolean  @default(true)
  createdById        String?
  createdByName      String?
  lastModifiedById   String?
  lastModifiedByName String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  cliente            Cliente  @relation(fields: [clienteId], references: [id], onDelete: Cascade)

  @@map("credentials")
}

model ClienteUsuario {
  id        String   @id @default(cuid())
  clienteId String
  usuarioId String
  role      String   @default("MEMBER")
  createdAt DateTime @default(now())
  cliente   Cliente  @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  usuario   Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([clienteId, usuarioId])
  @@map("clientes_usuarios")
}

model Usuario {
  id                   String              @id @default(cuid())
  name                 String
  email                String?
  role                 String              @default("DEV")
  position             String?
  avatarUrl            String?
  joinDate             DateTime            @default(now())
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  password             String?
  tipoContrato         String              @default("COMPLETA")
  ciudad               String?
  codigoPostal         String?
  direccion            String?
  dni                  String?
  fechaNacimiento      DateTime?
  iban                 String?
  telefono             String?
  telefonoEmergencia   String?
  titularCuenta        String?
  fechaAltaSS          DateTime?
  numSeguridadSocial   String?
  tipoContratacion     String?
  clientesAsignados    ClienteUsuario[]
  eventos              eventos[]
  jornadas             jornadas[]
  permisos_aprobador   permisos[]          @relation("permisos_aprobadorIdTousuarios")
  permisos_solicitante permisos[]          @relation("permisos_solicitanteIdTousuarios")
  proyectos            Proyecto[]
  tareasAsignadas      Tarea[]             @relation("TareaAssignee")
  ticket_respuestas    ticket_respuestas[]
  ticketsReceived      Ticket[]            @relation("TicketRecipient")
  ticketsSent          Ticket[]            @relation("TicketSender")
  timeEntries          TimeEntry[]

  @@map("usuarios")
}

model Proyecto {
  id                 String               @id @default(cuid())
  title              String
  clienteId          String
  responsibleId      String?
  status             String               @default("ACTIVE")
  budget             Float?
  deadline           DateTime?
  isArchived         Boolean              @default(false)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  tags               String[]             @default([])
  campanasSEM        CampanaSEM[]
  cliente            Cliente              @relation(fields: [clienteId], references: [id])
  responsable        Usuario?             @relation(fields: [responsibleId], references: [id])
  tareas             Tarea[]
  tareas_recurrentes tareas_recurrentes[]

  @@map("proyectos")
}

model Tarea {
  id             String      @id @default(cuid())
  title          String
  description    String?
  status         String      @default("PENDING")
  priority       String      @default("MEDIUM")
  type           String      @default("OPERATIONAL")
  proyectoId     String
  assigneeId     String?
  estimatedHours Float?
  dueDate        DateTime?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  assignee       Usuario?    @relation("TareaAssignee", fields: [assigneeId], references: [id])
  proyecto       Proyecto    @relation(fields: [proyectoId], references: [id])
  timeEntries    TimeEntry[]

  @@map("tareas")
}

model TimeEntry {
  id          String    @id @default(cuid())
  userId      String
  tareaId     String?
  startTime   DateTime
  endTime     DateTime?
  description String?
  createdAt   DateTime  @default(now())
  tarea       Tarea?    @relation(fields: [tareaId], references: [id])
  usuario     Usuario   @relation(fields: [userId], references: [id])

  @@map("time_entries")
}

model Ticket {
  id                String              @id @default(cuid())
  title             String
  description       String?
  status            String              @default("OPEN")
  priority          String              @default("MEDIUM")
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  recipientId       String?
  senderId          String
  readBy            String[]            @default([])
  ticket_respuestas ticket_respuestas[]
  recipient         Usuario?            @relation("TicketRecipient", fields: [recipientId], references: [id])
  sender            Usuario             @relation("TicketSender", fields: [senderId], references: [id])

  @@map("tickets")
}

model categorias_servicio {
  id               String             @id
  codigo           String             @unique
  nombre           String
  descripcion      String?
  color            String             @default("#6B7280")
  icono            String?
  orden            Int                @default(0)
  activo           Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  plantillas_tarea plantillas_tarea[]
}

model eventos {
  id          String    @id
  title       String
  description String?
  type        String    @default("MEETING")
  startDate   DateTime
  endDate     DateTime?
  startTime   String?
  endTime     String?
  allDay      Boolean   @default(false)
  color       String?
  createdById String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  createdBy   Usuario?  @relation(fields: [createdById], references: [id])
}

model jornadas {
  id                   String    @id
  usuarioId            String
  fecha                DateTime  @db.Date
  horaInicio           DateTime
  horaPausaAlmuerzo    DateTime?
  horaReinicioAlmuerzo DateTime?
  horaFin              DateTime?
  totalMinutos         Int?
  estado               String    @default("EN_CURSO")
  createdAt            DateTime  @default(now())
  updatedAt            DateTime
  usuario              Usuario   @relation(fields: [usuarioId], references: [id])

  @@unique([usuarioId, fecha])
}

model permisos {
  id              String    @id
  tipo            String
  motivo          String?
  fechaInicio     DateTime
  fechaFin        DateTime
  estado          String    @default("PENDIENTE")
  fechaSolicitud  DateTime  @default(now())
  fechaResolucion DateTime?
  comentarioAdmin String?
  solicitanteId   String
  aprobadorId     String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  aprobador       Usuario?  @relation("permisos_aprobadorIdTousuarios", fields: [aprobadorId], references: [id])
  solicitante     Usuario   @relation("permisos_solicitanteIdTousuarios", fields: [solicitanteId], references: [id])
}

model plantillas_tarea {
  id              String              @id
  codigo          String              @unique
  nombre          String
  descripcion     String?
  categoriaId     String
  rolSugeridoTipo String?
  tiempoEstimado  Float               @default(1)
  esRecurrente    Boolean             @default(false)
  frecuencia      String?
  activo          Boolean             @default(true)
  orden           Int                 @default(0)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime
  categoria       categorias_servicio @relation(fields: [categoriaId], references: [id])
}

model Proveedor {
  id        String    @id @default(cuid())
  nombre    String    @unique
  tipo      String
  website   String?
  notas     String?
  activo    Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  dominios  Dominio[]
  hostings  Hosting[]

  @@map("proveedores")
}

model Hosting {
  id                    String    @id @default(cuid())
  clienteId             String
  proveedorId           String
  nombre                String
  webAsociada           String?
  tieneSSL              Boolean   @default(false)
  tipoSSL               String?
  fechaVencimientoSSL   DateTime?
  tipoHosting           String
  especificaciones      String?
  ipServidor            String?
  panelControl          String?
  urlPanel              String?
  usuarioPanel          String?
  passwordPanel         String?
  importeCoste          Float
  importeVenta          Float
  periodicidad          String    @default("ANUAL")
  fechaContratacion     DateTime
  fechaVencimiento      DateTime
  fechaUltimaRenovacion DateTime?
  estado                String    @default("ACTIVO")
  autoRenovar           Boolean   @default(true)
  notificado30Dias      Boolean   @default(false)
  notas                 String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  dominios              Dominio[]
  cliente               Cliente   @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  proveedor             Proveedor @relation(fields: [proveedorId], references: [id])

  @@map("hostings")
}

model Dominio {
  id                    String    @id @default(cuid())
  clienteId             String
  hostingId             String?
  proveedorId           String
  nombre                String
  extension             String
  tieneSSL              Boolean   @default(false)
  tipoSSL               String?
  fechaVencimientoSSL   DateTime?
  nameservers           String?
  registroDNS           String?
  importeCoste          Float
  importeVenta          Float
  periodicidad          String    @default("ANUAL")
  fechaRegistro         DateTime
  fechaVencimiento      DateTime
  fechaUltimaRenovacion DateTime?
  estado                String    @default("ACTIVO")
  autoRenovar           Boolean   @default(true)
  notificado30Dias      Boolean   @default(false)
  notas                 String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  cliente               Cliente   @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  hosting               Hosting?  @relation(fields: [hostingId], references: [id])
  proveedor             Proveedor @relation(fields: [proveedorId], references: [id])

  @@map("dominios")
}

model PlanHosting {
  id             String   @id @default(cuid())
  nombre         String
  tipo           String
  descripcion    String?
  espacio        String?
  emails         Int?
  incluyeDominio Boolean  @default(false)
  precioCoste    Float
  precioSugerido Float?
  activo         Boolean  @default(true)
  orden          Int      @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("planes_hosting")
}

model ServicioRecurrente {
  id                 String     @id @default(cuid())
  codigo             String     @unique
  nombre             String
  descripcion        String?
  categoria          String
  precioBase         Float?
  activo             Boolean    @default(true)
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  cuotaActivacion    Float?
  serviciosIncluidos String?
  tipo               String     @default("INDIVIDUAL")
  contratos          Contrato[]

  @@map("servicios_recurrentes")
}

model Contrato {
  id               String              @id @default(cuid())
  clienteId        String
  servicioId       String
  nombre           String?
  descripcion      String?
  importeMensual   Float
  periodicidad     String              @default("MENSUAL")
  fechaInicio      DateTime
  fechaFin         DateTime?
  fechaRenovacion  DateTime?
  autoRenovar      Boolean             @default(true)
  estado           String              @default("ACTIVO")
  notas            String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  activacionPagada Boolean             @default(false)
  cuotaActivacion  Float?
  cliente          Cliente             @relation(fields: [clienteId], references: [id])
  servicio         ServicioRecurrente  @relation(fields: [servicioId], references: [id])
  historial        HistorialContrato[]

  @@map("contratos")
}

model HistorialContrato {
  id            String   @id @default(cuid())
  contratoId    String
  tipo          String
  descripcion   String?
  valorAnterior Float?
  valorNuevo    Float?
  fecha         DateTime @default(now())
  contrato      Contrato @relation(fields: [contratoId], references: [id])

  @@map("historial_contratos")
}

model CampanaSEM {
  id              String       @id @default(cuid())
  clienteId       String
  proyectoId      String?
  nombre          String
  plataforma      String
  estado          String       @default("PLANIFICADA")
  fechaInicio     DateTime
  fechaFin        DateTime?
  presupuesto     Float
  objetivo        String?
  notas           String?
  urlPlataforma   String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  cliente         Cliente      @relation(fields: [clienteId], references: [id])
  proyecto        Proyecto?    @relation(fields: [proyectoId], references: [id])
  reportesDiarios ReporteSEM[]

  @@map("campanas_sem")
}

model ReporteSEM {
  id           String     @id @default(cuid())
  campanaId    String
  fecha        DateTime
  impresiones  Int        @default(0)
  clics        Int        @default(0)
  ctr          Float      @default(0)
  conversiones Int        @default(0)
  cpa          Float      @default(0)
  gastoDia     Float      @default(0)
  roas         Float      @default(0)
  notas        String?
  createdAt    DateTime   @default(now())
  campana      CampanaSEM @relation(fields: [campanaId], references: [id])

  @@unique([campanaId, fecha])
  @@map("reportes_sem")
}

model CampanaMailing {
  id              String    @id @default(cuid())
  clienteId       String
  nombreInterno   String
  asunto          String?
  plataforma      String
  estado          String    @default("BORRADOR")
  fechaEnvio      DateTime?
  tamanoAudiencia Int       @default(0)
  entregados      Int       @default(0)
  aperturas       Int       @default(0)
  clics           Int       @default(0)
  rebotes         Int       @default(0)
  bajas           Int       @default(0)
  spam            Int       @default(0)
  notas           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  cliente         Cliente   @relation(fields: [clienteId], references: [id])

  @@map("campanas_mailing")
}

model DocumentoSoporte {
  id              String   @id @default(cuid())
  nombre          String
  descripcion     String?
  familia         String
  subfamilia      String?
  archivoUrl      String?
  archivoNombre   String?
  tamano          Int?
  tipo            String?
  creadoPorId     String?
  creadoPorNombre String?
  activo          Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("documentos_soporte")
}

model tareas_recurrentes {
  id                String    @id
  titulo            String
  descripcion       String?
  proyectoId        String
  assigneeId        String?
  prioridad         String    @default("MEDIUM")
  tipo              String    @default("OPERATIONAL")
  horasEstimadas    Float?
  frecuencia        String
  diasAntelacion    Int       @default(3)
  diaEjecucion      Int?
  activa            Boolean   @default(true)
  ultimaGeneracion  DateTime?
  proximaGeneracion DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  proyectos         Proyecto  @relation(fields: [proyectoId], references: [id])
}

model ticket_respuestas {
  id        String   @id
  ticketId  String
  userId    String
  mensaje   String
  createdAt DateTime @default(now())
  tickets   Ticket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  usuarios  Usuario  @relation(fields: [userId], references: [id])
}

// Force rebuild v2
